<!DOCTYPE html>
<html>
<!--#set var=TITLE value="TCW Troubleshooting" -->
<!--#include virtual="./ssi/head.html" -->
<!--#include virtual="./ssi/start1.html" -->

<a name=top>
<!------------- Trouble -------------------->
<a name=trouble></a>
<h2>Troubleshooting</h2>
<u>Content:</u>
<ul>
<li><a href=#mysql>MySQL suggested settings</a>
<li><a href=#db>MySQL connection errors</a>
<li><a href=#mem>Out of memory</a>
<li><a href=#ext>External executable problems</a>
<li><a href=#run>Error Reports</a>
</ul>

<!---------------------------------------------------------!>
<hr>
<a name="mysql">
<h2>MySQL suggested settings</h2>
<table cellspacing=3 cellpadding=2 border=1 rules=all>
	<tr>
		<td align=left valign=top><tt>max_allowed_packet</td>
		<td>
This should be at least 500M if possible (the units are bytes). 
		</td>
	</tr>	
	<tr>
		<td align=left valign=top><tt>local_infile</td>
		<td>
Set to 1. 
		</td>
	</tr>	
</table>
<br>For all TCW software, the mySQL variable <tt>max_allowed_packet</tt> must be a reasonable
size. To check the value, either:
<pre>./runSingle -v</pre>
or, start mysql and type:
<pre>show variables like "max_allowed_packet"; </pre>
To change this variable, start mysql and type:
<pre>set global max_allowed_packet=1073741824;</pre>

For <code>runAS</code>, the following is necessary:
<pre>
set global local_infile=1
</pre>
Testing TCW on MacOS Catalina with MySQL v8.0.17: 
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the above two seem to be the only important ones.
<br>Testing TCW on Linux x86.64 (Centos 7) with MariaDB v10.4.12:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; may be more sensitive, as discussed in next section.

<h3>MariaDB</h3>
Two MySQL settings are especially important for assembly performance (and generally for InnoDB table
performance). 
<p>
<table cellspacing=3 cellpadding=2 border=1 rules=all>
	<tr>
		<td align=left valign=top><tt>innodb_buffer_pool_size</td>
		<td>
The default is too low for most purposes. You should set this to around 1Gb if possible (note that 
the units are bytes). 
		</td>
	</tr>
	<tr>
		<td align=left valign=top><tt>innodb_flush_log_at_trx_commit</td>
		<td>
The default setting is 1, which results in very slow uploading of data.
		</td>
	</tr>
</table>
<p>
To check the values, start mysql and type:
<pre>
show variables like "innodb_buffer_pool_size"; 
show variables like "innodb_flush_log_at_trx_commit"; 
</pre>
To change the variables, then type:
<pre>
set global innodb_buffer_pool_size=1073741824;
set global innodb_flush_log_at_trx_commit=0;
</pre>
Alternatively, You can set these in the MySQL configuration file <tt>my.cnf</tt> and restart MySQL. 
Note that <tt>my.cnf</tt> is typically located at <tt>/etc/my.cnf</tt>, on both Linux and Mac.

<a name="db">
<table width='100%'><tr><td align='left' >
<h2>MySQL connection errors</h2>
</td><td align='right' valign='top' class='smtxt'><a href=#top>Go to top</a></td></tr></table>
	
If TCW cannot connect to the database, generally the problem is the access privileges of the DB_user
 in the HOSTS.cfg (firewalls are another common problem - talk to your system administrator). 

<p>MySQL privileges are very specific and must exactly match the hostname in HOSTS.cfg. 
<br> For example, if DB_host = localhost, DB_user=user, then privileges must be granted to 'user@localhost'.
Sometimes you may need equivalent variants, e.g. if localhost has IP 74.125.239.17 
and domain my.domain.org, you may also need 'user@74.125.239.17' and 'user@my.domain.org'. 
<p>
Privilege problems are easiest to debug by running the 'mysql' command line client.
Run:
<div class="codesec"><pre>
mysql -u &lt;DB_user&gt; -p -h &lt;DB_host&gt;
</div></pre> 
and enter the DB_password when prompted. If this fails, then the user/password privileges have
to be corrected. If it succeeds, then try to add and drop a test database:
<div class="codesec"><pre>
>create database TCW_PRIVTEST;
>drop database TCW_PRIVTEST;
</pre></div>
If this fails you can still run TCW, but you will need an administrator to create
the TCW database since <tt>runSingleTCW</tt> cannot do it. 

<a name=mem></a>
<table width='100%'><tr><td align='left' >
<h2>Out of memory</h2>
</td><td align='right' valign='top' class='smtxt'><a href=#top>Go to top</a></td></tr></table>

Java applications must specify their memory usage in advance, so it is very 
important to set it high enough. 
The setting is adjusted by editing the appropriate launch script,
by increasing the "-Xmx" parameter value on the java command line.   

<p>
If you run out during initial project loading, 
edit the <tt>execLoadLib</tt> script to increase
the numeric value of "-Xmx8192m", and load
 using <tt>./execLoadLib &lt;project&gt;</tt>. 
 <p>
If you run out during instantiation/assembly, 
edit the <tt>execAssm</tt> script to increase
the numeric value of "-Xmx8192m" , and run the
instantiation using <tt>./execAssm &lt;project&gt;</tt>.  
<p>
If you run out of memory while annotating, 
edit the <tt>execAnno</tt> script to increase
the numeric value of "-Xmx8192m", and add
your annotation using <tt>./execAnno &lt;project&gt;</tt>.
   
<p>
If you run out of memory with 
<tt>runDE</tt>, <tt>viewSingleTCW</tt>,  <tt>runMultiTCW</tt>, or <tt>viewMultiTCW</tt>,
edit the respective script to increase
the numeric value of "-Xmx8192m" and re-run.

<a name=ext></a>
<table width='100%'><tr><td align='left' >
<h2>External executable problems</h2>
</td><td align='right' valign='top' class='smtxt'><a href=#top>Go to top</a></td></tr></table>

These program are in the TCW subdirectories <tt>/Ext/linux</tt> and <tt>/Ext/mac</tt>.
<h3>Not executable</h3>
If on startup, you get a message like:
<pre>
***Error: file is not executable: ext/mac/mafft/mafft.bat
</pre>

From the <tt>/Ext</tt> directory, <tt>chmod -R 775 mafft</tt> to give all necessary
executables and scripts in the directory permission to execute.

<p>NOTE: MacOS 10.15 (Catalina) does not allow downloaded programs to execute. Running through TCW,
you will either get popup that states "xxx cannot be opened because developer cannot be verified", or
the program will just fail. See <a href=./Mac-OSX.html#ext class="ext" target="_blank">MacOS</a>.

<h3>External program fails</h3>
Generally, the command is written to the terminal by TCW. Copy and paste it at the command line. By executing it like
this, you will see all the external programs messages, which generally elucidates the
problem.
<p>If this does not work, try executing it in the <tt>/Ext</tt> directory, 
which may indicate the problem. 
<p>It may be necessary to compile the program for your machine and replace the existing
executable, in which case, see <a href=./Install.html#replace  class="ext" target="_blank">Install Replace Executable</a>.

<a name=run></a>
<table width='100%'><tr><td align='left' >
<h2>Errors reports</h2>
</td><td align='right' valign='top' class='smtxt'><a href=#top>Go to top</a></td></tr></table>

<table border=1 cellspacing=3 cellpadding=2>
<tr><th>Program<th>Error file<th>Log file
<tr><td colspan=3><tt>RunSingleTCW</tt>
<tr><td>&nbsp;&nbsp;&nbsp;Build Database<td>sTCW.error1.log<td>projects/&lt;name&gt;/logs/load.log
<tr><td>&nbsp;&nbsp;&nbsp;Instantiate<td>sTCW.error1.log<td>projects/&lt;name&gt;/logs/inst.log
<tr><td>&nbsp;&nbsp;&nbsp;Annotate<td>sTCW.error.log<td>projects/&lt;name&gt;/logs/anno.log
<tr><td colspan=3>Everything else
<tr><td><tt>runAS</tt><td>sTCW.error.log<td>projects/DBfasta/logs
<tr><td><tt>runDE</tt><td>sTCW.error.log<td>-
<tr><td><tt>viewSingleTCW</tt><td>sTCW.error.log<td>-
<tr><td><tt>runMultiTCW</tt><td>mTCW.error.log<td>projcmp/&lt;name&gt;/logs
<tr><td><tt>viewMultiTCW</tt><td>sTCW.error.log<td>-
</table>
<p>
The error log file may indicate the problem, otherwise, 
email it to <tt>tcw at agcol.arizona.edu</tt>.


<p><a href="#top">Return to top</a><br>
<!--#include virtual="./ssi/end.html" -->


</html> 
